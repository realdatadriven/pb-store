{{ define "content" }}
<div class="min-h-screen bg-white flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
	<div class="max-w-md w-full space-y-8">
		<div>
			<h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
				Create your account
			</h2>
			<p class="mt-2 text-center text-sm text-gray-600">
				Or
				<a href="/login" class="font-medium text-black hover:text-gray-800">
					sign in to your existing account
				</a>
			</p>
		</div>
		<form class="mt-8 space-y-6" id="register-form">
			<div class="space-y-4">
				<div>
					<label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
					<input id="name" name="name" type="text" required 
						   class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm" 
						   placeholder="Enter your full name">
				</div>
				<div>
					<label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
					<input id="email" name="email" type="email" autocomplete="email" required 
						   class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm" 
						   placeholder="Enter your email address">
				</div>
				<div>
					<label for="password" class="block text-sm font-medium text-gray-700">Password</label>
					<input id="password" name="password" type="password" autocomplete="new-password" required 
						   class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm" 
						   placeholder="Create a password">
				</div>
				<div>
					<label for="passwordConfirm" class="block text-sm font-medium text-gray-700">Confirm Password</label>
					<input id="passwordConfirm" name="passwordConfirm" type="password" autocomplete="new-password" required 
						   class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm" 
						   placeholder="Confirm your password">
				</div>
			</div>

			<div class="flex items-center">
				<input id="agree-terms" name="agree-terms" type="checkbox" required 
					   class="h-4 w-4 text-black focus:ring-black border-gray-300 rounded">
				<label for="agree-terms" class="ml-2 block text-sm text-gray-900">
					I agree to the 
					<a href="/terms" class="text-black hover:text-gray-800 underline">Terms of Service</a>
					and 
					<a href="/privacy" class="text-black hover:text-gray-800 underline">Privacy Policy</a>
				</label>
			</div>

			<div>
				<button type="submit" 
						class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
					Create Account
				</button>
			</div>

			<div class="text-center">
				<p class="text-sm text-gray-600">
					Already have an account?
					<a href="/login" class="font-medium text-black hover:text-gray-800">
						Sign in here
					</a>
				</p>
			</div>
		</form>
	</div>
</div>

<script>
document.getElementById('register-form').addEventListener('submit', function(e) {
	e.preventDefault();
	
	const formData = new FormData(this);
	const name = formData.get('name');
	const email = formData.get('email');
	const password = formData.get('password');
	const passwordConfirm = formData.get('passwordConfirm');
	
	// Validate passwords match
	if (password !== passwordConfirm) {
		alert('Passwords do not match');
		return;
	}
	
	// Validate password strength
	if (password.length < 6) {
		alert('Password must be at least 6 characters long');
		return;
	}
	
	// Try to register with PocketBase
	fetch('/api/collections/users/records', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
		},
		body: JSON.stringify({
			name: name,
			email: email,
			password: password,
			passwordConfirm: passwordConfirm
		})
	})
	.then(response => response.json())
	.then(data => {
		if (data.id) {
			alert('Account created successfully! Please log in.');
			window.location.href = '/login';
		} else {
			alert('Registration failed: ' + (data.message || 'Unknown error'));
		}
	})
	.catch(error => {
		console.error('Registration error:', error);
		alert('Registration failed. Please try again.');
	});
});

// Check if user is already logged in
const user = JSON.parse(localStorage.getItem('user') || '{}');
if (user.loggedIn) {
	window.location.href = '/';
}
</script>
{{ end }}
{{ template "store" . }}

